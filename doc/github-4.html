<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">

<style>body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
    -moz-border-top-colors: none;
    -moz-border-right-colors: none;
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    background-color: #dddddd;
    background-image: linear-gradient(#f1f1f1, #dddddd);
    background-repeat: repeat-x;
    border-radius: 2px;
    border-width: 1px;
    border-color: #dddddd #cccccc #cccccc #dddddd;
    border-image: none;
    border-style: solid;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}</style>
</head>
<body>
<ul>
<li><a href="#Install">Install</a></li>
<li><a href="#Quick%20Tour">Quick Tour</a>

<ul>
<li><a href="#How%20to%20use%20it%20with%20JSON">How to use it with JSON</a></li>
<li><a href="#How%20to%20use%20it%20with%20XML">How to use it with XML (and be aligned with JSON)</a></li>
<li><a href="#How%20to%20use%20predicates">How to use predicates</a></li>
<li><a href="#Predefined%20Steps">Predefined Steps</a></li>
</ul>
</li>
<li><a href="#Customize">Customize</a>

<ul>
<li><a href="#Building%20your%20own%20wrappers">Building your own wrappers</a></li>
<li><a href="#Building%20views%20with%20your%20own%20steps">Building views with your own steps</a></li>
</ul>
</li>
<li><a href="#Concepts">Concepts</a></li>
<li><a href="#Performance">Performance</a></li>
</ul>


<h2 id="Install.a.name..Install....a.">Install<a name="Install"></a></h2>

<p>Download the project and run maven:</p>

<pre><code class="maven">mvn package
</code></pre>

<p>or download the pre-built jars (in the project root):</p>

<pre><code>apath-0.9.0.jar, apath-0.9.0-sources.jar
</code></pre>

<p>Dependencies: see POM.xml</p>

<h2 id="Quick.Tour.a.name..Quick.Tour....a.">Quick Tour<a name="Quick Tour"></a></h2>

<h3 id="How.to.use.it.with.JSON.a.name..How.to.use.it.with.JSON....a.">How to use it with JSON<a name="How to use it with JSON"></a></h3>

<p>The obligatory book snippet <a name="bsn"></a> (borrowed from <a href="http://goessner.net/articles/JsonPath">JSONPath</a>):</p>

<pre><code class="json">{
    "root": {
        "store": {
            "book": [
                {
                    "category": "reference",
                    "author": "Nigel Rees",
                    "title": "Sayings of the Century",
                    "price": 8.95
                },
                {
                    "category": "fiction",
                    "author": "Evelyn Waugh",
                    "title": "Sword of Honour",
                    "price": 12.99
                }
            ],
            "bicycle": {
                "color": "red",
                "price": 19.95
            }
        },
        "expensive": 10
    }
}
</code></pre>

<p><strong>Set-up.</strong> (1) parse JSON - (2) Wrapper for JSONSmart - (3) apath processor:</p>

<pre><code class="java">// net.minidev.json.JSONObject

JSONObject jo = (JSONObject) JSONValue.parse(new FileReader("books.json")); //(1)

StepBuilder sb = new JsonSmartStepBuilder(); //(2)
PathProcessor processor = new PathProcessor(); //(3)
</code></pre>

<p><strong>Select.</strong> (1) create a path - (2) select by path with the processor:</p>

<pre><code class="java">Path path = new Path(sb.childrenByName("root"),
        sb.childrenByName("store"),
        sb.childrenByName("book"),
        sb.allChildren(),
        sb.childrenByName("author"),
        sb.stringValue()); //(1)

List&lt;Object&gt; results = processor.selectAll(jo, path); //(2)
// ~&gt; [Nigel Rees, Evelyn Waugh]
</code></pre>

<p><strong>Be more compact.</strong> Path object equivalent to the above one:</p>

<pre><code class="java">SimplePathBuilder pb = new SimplePathBuilder(sb);

Path path = pb.buildPathFromTerms("root", "store", "book", "*", "author", "string()");
</code></pre>

<p>Note that path builders for concrete languages like JSONPath or XPath (subsets) could be developed.</p>

<h3 id="How.to.use.it.with.XML..and.be.aligned.with.JSON..a.name..How.to.use.it.with.XML....a.">How to use it with XML (and be aligned with JSON)<a name="How to use it with XML"></a></h3>

<p>The corresponding XML :</p>

<pre><code class="xml">&lt;root&gt;
    &lt;store&gt;
        &lt;book&gt;
            &lt;category&gt;reference&lt;/category&gt;
            &lt;author&gt;Nigel Rees&lt;/author&gt;
            &lt;title&gt;Sayings of the Century&lt;/title&gt;
            &lt;price&gt;8.95&lt;/price&gt;
        &lt;/book&gt;
        &lt;book&gt;
            &lt;category&gt;fiction&lt;/category&gt;
            &lt;author&gt;Evelyn Waugh&lt;/author&gt;
            &lt;title&gt;Sword of Honour&lt;/title&gt;
            &lt;price&gt;12.99&lt;/price&gt;
        &lt;/book&gt;
        &lt;bicycle&gt;
            &lt;color&gt;red&lt;/color&gt;
            &lt;price&gt;19.95&lt;/price&gt;
        &lt;/bicycle&gt;
    &lt;/store&gt;
    &lt;expensive&gt;10&lt;/expensive&gt;
&lt;/root&gt;
</code></pre>

<p><strong>Use JDK as usual.</strong></p>

<pre><code class="java">DocumentBuilder builder = DocumentBuilderFactory.newInstance().newDocumentBuilder();
Document doc = builder.parse(new FileInputStream("books.xml"));
</code></pre>

<p><strong>Select.</strong> (1) use the wrapper for JDK-DOM - (2) no &lsquo;*&rsquo; after <code>book</code> is needed (~XPath):</p>

<pre><code class="java">sb = new JdkDomStepBuilder(); //(1)
pb = new SimplePathBuilder(sb);

results = processor.selectAll(
        doc, pb.buildPathFromTerms("root", "store", "book", "author", "string()")); //(2)
</code></pre>

<p><strong>Align with JSON</strong>. (1) tell the JSON wrapper that you don&rsquo;t want arrays as first class before name selection:</p>

<pre><code class="java">boolean skipArraysAtNameSelection = true;
StepBuilder sb = new JsonSmartStepBuilder(skipArraysAtNameSelection);
</code></pre>

<p>Now you can use the same path for JSON too.</p>

<h3 id="How.to.use.predicates.a.name..How.to.use.predicates....a.">How to use predicates<a name="How to use predicates"></a></h3>

<p>&hellip; coming soon &hellip;</p>

<h3 id="Predefined.Steps.a.name..Predefined.Steps....a.">Predefined Steps<a name="Predefined Steps"></a></h3>

<p>Comparison with JSONPath and XPath:</p>

<table>
<thead>
<tr>
<th> apath step                       </th>
<th> JSONPath           </th>
<th> XPath  </th>
</tr>
</thead>
<tbody>
<tr>
<td> childrenByName(String <em>name</em>)      </td>
<td> <em>name</em><br> <em>*.name</em> <strong>(1)</strong> </td>
<td> <em>name</em> </td>
</tr>
<tr>
<td> childByIndex(int i)      </td>
<td> [i]      </td>
<td> [i]  </td>
</tr>
<tr>
<td> allChildren() </td>
<td> *      </td>
<td>    * </td>
</tr>
<tr>
<td> descendants() </td>
<td> ..      </td>
<td>    // </td>
</tr>
</tbody>
</table>


<p><strong>(1)</strong> if the context is an JSON array and <code>skipArraysAtNameSelection</code> is true.</p>

<h2 id="Customize.a.name..Customize....a.">Customize<a name="Customize"></a></h2>

<h3 id="Building.your.own.wrappers.a.name..Building.your.own.wrappers....a.">Building your own wrappers<a name="Building your own wrappers"></a></h3>

<p>Wrapping objects in <em>apath</em> is done by implementing so-called <em>step builders</em> as an extension of <a href="https://github.com/a-f-m/apath/blob/master/src/main/java/org/afm/apath/core/StepBuilder.java">org.afm.apath.core.StepBuilder</a>. One example is <a href="https://github.com/a-f-m/apath/blob/master/src/main/java/org/afm/apath/builders/JsonSmartStepBuilder.java">org.afm.apath.builders.JsonSmartStepBuilder</a>.</p>

<p>Note that <em>apath</em> aims at maximal loose coupling of the builder and the underlying structure. Therefore no extra wrapper classes for underlying classes (e.g. JSONObject or JSONArray) are created by delegation or inheritance, also to gain better performance. As a consequence, builder elements mainly use the <em>instanceOf</em>-operator and are most generally typed (using <em>Object</em> or <em>Iterator&lt;Object></em> for step results). It is similar to the usual style in untyped languages (e.g. JavaScript). <strong>Warning</strong>: due to that searching for errors could be expensive (as usual in untyped languages).</p>

<p>Here we want to re-develop the <em>JsonSmartStepBuilder</em> to exemplify the process.</p>

<p><strong>The skeleton</strong>. Extension of <a href="https://github.com/a-f-m/apath/blob/master/src/main/java/org/afm/apath/core/StepBuilder.java">org.afm.apath.core.StepBuilder</a> (e.g. generated with Eclipse):</p>

<pre><code class="java">public class JsonSmartStepBuilder extends StepBuilder {

    @Override
    public ChildrenByName childrenByName(String name) {
        // TODO Auto-generated method stub
        return null;
    }

    @Override
    public ChildByIndex childByIndex(int i) {
        // TODO Auto-generated method stub
        return null;
    }

    @Override
    public AllChildren allChildren() {
        // TODO Auto-generated method stub
        return null;
    }
}
</code></pre>

<p><strong>Extending</strong> org.afm.apath.core.Step.ChildrenByName:</p>

<pre><code class="java">class JsChildrenByName extends ChildrenByName {

    public JsChildrenByName(String name) {
        super(name);
    }

    /**
     * Applies this step to a node.
     * ...
     */
    @Override
    public Object applyTo(Object node, Path enclosingPath, int currStepNo) {

        if (node instanceof JSONObject) {

            Object jo = ((JSONObject) node).get(name); //(1)
            if (jo != null) {
                return skipArrays &amp;&amp; jo instanceof JSONArray ? 
                    skipArray(jo, enclosingPath, currStepNo) : jo;
                //(2)
            }
        }
        return null; //(3)
    }
}
</code></pre>

<p>(1) - usual selection if node is an JSONObject</p>

<p>(2) - possibly skipping arrays or return the selection</p>

<p>(3) - <code>null</code> means that the step has no results</p>

<p><strong>Use it</strong> in the <code>JsonSmartStepBuilder</code> builder above:</p>

<pre><code class="java">@Override
public ChildrenByName childrenByName(String name) {

    return new JsChildrenByName(name);
}
</code></pre>

<p>The <em>ChildByIndex</em>-step is performed analogously. Note that results in the <em>AllChildren</em>-step are iterators:</p>

<pre><code class="java">class JsAllChildren extends AllChildren {

    ...

    @Override
    public Iterator&lt;Object&gt; applyTo(Object node, Path enclosingPath, int currStepNo) {

        if (node instanceof JSONObject) {
            return ((JSONObject) node).values().iterator();

        } else if (node instanceof JSONArray) {
            return ((JSONArray) node).iterator();
        }
        return Collections.emptyIterator();
    }
}
</code></pre>

<h3 id="Building.views.with.your.own.steps.a.name..Building.views.with.your.own.steps....a.">Building views with your own steps<a name="Building views with your own steps"></a></h3>

<p>To exemplify views over JSON more adequate, we modify the above book <a href="#bsn">snippet</a> such that it has an additional level according to the categories:</p>

<pre><code class="json">...
    "book": {
        "references": [
            {
                "author": "Nigel Rees",
                "title": "Sayings of the Century",
                "price": 8.95
            }
        ],
        "fictions": [
            {
                "author": "Evelyn Waugh",
                "title": "Sword of Honour",
                "price": 12.99
            }
        ]
    },
...
</code></pre>

<p>Assume that we want to retrieve books with a special category and price without formulating a path equivalent to the JSON structure. Instead, we want to build an own step <code>books(category, priceThreshold)</code> to retrieve books according to a category and price threshold. This cann be seen as a classical view. Note that the implementation of this step requires knowledge of the custom structure given by the above snippet:.</p>

<p><strong>First, exending your step builder</strong>, here the <a href="https://github.com/a-f-m/apath/blob/master/src/main/java/org/afm/apath/builders/JsonSmartStepBuilder.java">org.afm.apath.builders.JsonSmartStepBuilder</a>.</p>

<pre><code class="java">public class MyStepBuilder extends JsonSmartStepBuilder {

    class Books implements Step {

        private double priceThreshold;
        private String category;

        public Books(double priceThreshold, String category) { //(1)
            this.priceThreshold = priceThreshold;
            this.category = category;
        }

        @Override
        public Iterator&lt;Object&gt; applyTo(Object node, Path enclosingPath, int currStepNo) {      
            //(2)
            // ... see below ... 
            return null;
        }
    }

    public Books books(double priceThreshold, String category) { //(3)
        return new Books(priceThreshold, category);
    }
}
</code></pre>

<p>(1) - Step construction.</p>

<p>(2) - The actual step evaluation (below).</p>

<p>(3) - Again, for convenience, the builder method to avoid direct instantiation at the caller.</p>

<p>The above snippet is the blueprint for introducing new steps. The <strong>actual step evaluation</strong> is implemented with the <code>applyTo</code>-method according to the book category and price threshold:</p>

<pre><code class="java">@Override
public Iterator&lt;Object&gt; applyTo(Object node, Path enclosingPath, int currStepNo) {

    if (node instanceof JSONObject) {
        // note: no cast checks for readability and compactness
        JSONObject book = (JSONObject) ((JSONObject) node).get("book"); //(1)
        if (book != null) {
            JSONArray categBooks = (JSONArray) ((JSONObject) book).get(category); //(2)
            if (categBooks != null) {
                return new Filter&lt;Object&gt;(categBooks.iterator()) { //(3)
                    protected boolean accept(Object x) {
                        return (double) ((JSONObject) x).get("price") &lt;= priceThreshold;
                    }
                };
            }
        }
    }
    return null;
}
</code></pre>

<p>(1) - Get the book collection.</p>

<p>(2) - Get the books of the category.</p>

<p>(3) - Filter by price threshold.</p>

<p>Note that the body of <code>applyTo</code> could be part of an extra method such that this functionality could be used in contexts where path processing is not relevant. Vice versa, existing methods could be used for customized path processing.</p>

<p>Remark: excessive casting has to be merely performed due to the JsonSmart-API.</p>

<p><strong>Finally, use your step</strong> as usual, e.g., to retrieve fictions cheaper than 15.00 Euro:</p>

<pre><code class="java">MyStepBuilder sb = new MyStepBuilder();
Path path = new Path(sb.descendants(), sb.books(15.0, "fictions"));

List&lt;Object&gt; l = new PathProcessor().selectAll(jo, path);
</code></pre>

<h4 id="How.to.build.a.hierarchical.view.over.java.objects">How to build a hierarchical view over java objects</h4>

<p>&hellip; coming soon &hellip;</p>

<h2 id="Concepts.a.name..Concepts....a.">Concepts<a name="Concepts"></a></h2>

<ul>
<li><p><em>apath</em> is a <em>small</em> (~50K) java library for selecting objects via simple, basic <strong>path</strong> expressions. One application is to access hierarchical structures like JSON, XML, S-Expressions, or others. Nevertheless, because only a <em>view</em> of the underlying data is defined, arbitrary structures can be handled as hierarchies.</p></li>
<li><p><em>apath</em> paths consists of <em>steps</em>, following the principles of <a href="https://www.w3.org/TR/2014/REC-xpath-30-20140408">XPath</a> and <a href="http://goessner.net/articles/JsonPath">JSONPath</a>, and offers a few basic, predefined <em>step constructors</em>. Although steps have intended semantics, users are free to give them own semantics in the context of their application. For instance, one implementation of the <strong>a</strong>bstract <em>childrenByName(name)</em>-step over JSON could be to skip the JSON-Array object (if it is the object to which the step is applied) as first class and to apply the step to the array items directly. This makes it possible to use the same path for selecting objects from JSON and XML, assuming some conventions for JSON structures.</p></li>
<li><p>One of the further conceptual goals was to allow for programmatically defining new custom step constructors. For example, if you want to access a typical department/employee structure, you can define a <em>members(name, salary)</em> step constructor that retrieves department members accordingly. Alternatively, <em>apath</em> provides filters to get members in the classic way. Note that steps are not intended to be orthogonal, for reasons of textual expressiveness.</p></li>
<li><p><em>apath</em> is &ldquo;open&rdquo; in both directions, i.e., as sketched above, in the layer below it arbitrary structures can be made ready for selection. In the layer above it, arbitrary concrete syntax parsers could be defined, that builds paths and steps accordingly. One scenario could be the implementation of XPath- or JSONPath- (subset) parsers.</p></li>
<li><p>The library is equipped with step constructors for <a href="https://github.com/netplex/json-smart-v2">json-smart</a> and jdk-xml-dom. Currently, no optimizations are performed. A <a href="#Performance">performance</a> evaluation below compare <em>apath</em> with <a href="https://github.com/jayway/JsonPath">jayway</a>, jdk-XPath and <a href="http://saxon.sourceforge.net/">saxon</a>.</p></li>
</ul>


<p><strong>Restrictions.</strong> The library is intended for use with in-memory JSON objects, XML Dom&rsquo;s, or others, although it is possible to access persistence systems. But so far it is unsuited in this scenario due to the fact that <em>apath</em> iterate over solutions step by step and does not work with query plans incorporating underlying index structures (in contrast to elaborated XPath engines).</p>

<h2 id="Performance.a.name..Performance....a.">Performance<a name="Performance"></a></h2>

<p>The following table shows the times in % of <code>apath over JsonSmart</code>.</p>

<table>
<thead>
<tr>
<th> Engine  </th>
<th> Children </th>
<th> Descendants </th>
<th> Chain </th>
<th>   </th>
</tr>
</thead>
<tbody>
<tr>
<td> apath over JsonSmart </td>
<td> 100 </td>
<td> 100 </td>
<td> 100 </td>
<td>  </td>
</tr>
<tr>
<td> apath over JdkDom </td>
<td> 250 </td>
<td> 295 </td>
<td> 495 </td>
<td> (*) </td>
</tr>
<tr>
<td> JSONPath/jayway over JsonSmart </td>
<td> 158 </td>
<td> 134 </td>
<td> 219 </td>
<td>  </td>
</tr>
<tr>
<td> XPath/Saxon over SaxonDom </td>
<td> 45 </td>
<td> 12 </td>
<td> 162 </td>
<td> (**) </td>
</tr>
<tr>
<td> XPath/Jdk-XPath over JdkDom </td>
<td> 1520 </td>
<td> 479 </td>
<td> 11318 </td>
<td>  </td>
</tr>
</tbody>
</table>


<p>Engines are designed by form <code>X over Y</code> where <em>X</em> states the language/engine and <em>Y</em> the underlying object structure.</p>

<p>(*) A little surprise is the difference to <code>XPath over JdkDom</code>. It could be that <code>XPath over JdkDom</code> perform a huge overhead and does not use the underlying objects directly whenever possible.</p>

<p>(**) As expected, <em>Children</em> and <em>Descendants</em> is faster with saxon (<em>Descendants</em> with at least than one order of magnitude), may be due to excessive use of index structures. Future work will focus on that issue. Interestingly, <code>apath over JsonSmart</code>-<em>Chain</em> is faster, may be due to less index overhead.</p>

<h2 id="Long.term.goals">Long term goals</h2>

<p>caching</p>

<p>learning</p>

<p>actions</p>

<p>matching (unif)</p>

<p>step branches (or sideway steps)</p>

<p>enforce path existence (path-<strong>a</strong>gnostic)</p>

<pre><code class="javascript">lalala
</code></pre>

<p>&bdquo;&ldquo;</p>

<h2 id="Design.notes:">Design notes:</h2>

<p>maximal loose coupling be &lsquo;Object&rsquo; ~javascript</p>

<p>no delegation (to avoid memory overhead)</p>

<p>no inheritance (to handle objects of final classes)</p>

<p>programmatic path construction (to not enforce exclusive use of an external concrete syntax like XPath)</p>

<p>Attention: initial version has no api doc</p>
</body>
</html>
